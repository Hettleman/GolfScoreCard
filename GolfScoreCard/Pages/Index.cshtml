@page
@model GolfScoreCard.Pages.IndexModel
@{
ViewData["Title"] = "Home";
}

@section Styles {
<link rel="stylesheet" href="/css/index.css" />
}

@await Html.PartialAsync("_PartialHero")
]
@section Scripts {
    <script>
    const input = document.getElementById("courseSearch");
    const dropdown = document.getElementById("dropdown");
    let debounceTimer;

    input.addEventListener("input", () => {
        clearTimeout(debounceTimer);

        debounceTimer = setTimeout(() => {
            fetchSuggestions(input.value.trim());
        }, 300);
    });
    
    
    async function fetchSuggestions(query) {
        dropdown.innerHTML = "";

        if (query.length < 2) {
            dropdown.style.display = "none";
            return;
        }

        
        const loadingDiv = document.createElement("div");
        loadingDiv.textContent = "Searching...";
        loadingDiv.style.color = "#666"; // subtle color
        dropdown.appendChild(loadingDiv);
        dropdown.style.display = "block";

        try {
            const res = await fetch(`/api/golfcourses?query=${encodeURIComponent(query)}`);
            const data = await res.json();
            const courses = data?.courses || [];

            dropdown.innerHTML = ""; // clear "Searching..."

            if (courses.length === 0) {
                const noResultsDiv = document.createElement("div");
                noResultsDiv.textContent = "No results found.";
                dropdown.appendChild(noResultsDiv);
                return;
            }

            courses.slice(0, 10).forEach(course => {
                const div = document.createElement("div");
                div.textContent = `${course.club_name} â€“ ${course.course_name}`;
                div.onclick = () => {
                    input.value = course.course_name;
                    dropdown.innerHTML = "";
                    dropdown.style.display = "none";
                    window.location.href = `/CourseInfo?id=${course.id}`;
                };
                dropdown.appendChild(div);
            });
            
            


        } catch (err) {
            dropdown.innerHTML = "<div style='color: red;'>Error loading courses</div>";
            console.error("Fetch error:", err);
        }
}





    document.addEventListener("click", (e) => {
        if (!document.querySelector(".search-wrapper").contains(e.target)) {
            dropdown.innerHTML = "";
            dropdown.style.display = "none";
        }
    });
</script>
}




